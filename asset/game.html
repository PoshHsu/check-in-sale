<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Canvas Example</title>
<script src="js/jquery-1.8.2.min.js"></script>
<script>
window.onload = function() {
    var canvas = document.getElementById("myCanvas");
    var context = canvas.getContext("2d");
};

var edge = 6,
	edge2 = Math.sqrt((edge-2)*(edge-2)),
	giftid=0; 

var gifts = new Array(edge*edge);

gifts[0] = '藍色小鴨';
gifts[1] = '藍色小鴨';
gifts[2] = '藍色小鴨';
gifts[3] = '藍色小鴨';
gifts[4] = '藍色小鴨';
gifts[5] = '藍色小鴨';
gifts[6] = '藍色小鴨';
gifts[11] = '藍色小鴨';
gifts[12] = '藍色小鴨';
gifts[17] = '藍色小鴨';
gifts[18] = '藍色小鴨';
gifts[23] = '藍色小鴨';
gifts[24] = '藍色小鴨';
gifts[29] = '藍色小鴨';
gifts[30] = '藍色小鴨';
gifts[31] = '藍色小鴨';
gifts[32] = '藍色小鴨';
gifts[33] = '藍色小鴨';
gifts[34] = '藍色小鴨';
gifts[35] = '藍色小鴨';
gifts[36] = '藍色小鴨';

$(document).ready(function(){
	
	for(var i = 0;i<edge*edge;i++){
		if((i%edge)<=edge2 && (i)%edge>0 && i>edge && i<edge*(edge-1)){
			$("#gifts").append('<img src="http://farm5.staticflickr.com/4114/4892837745_d08c1de0cc_s.jpg">');
		}else{		
			$("#gifts").append('<img src="http://farm6.staticflickr.com/5291/5437866454_84a29f7343_s.jpg">');
		}
	}

	$("#gifts").width(edge*80);
		
	function showGift(){
		console.log("gift:"+giftid);
		alert(gifts[giftid]);
		clearTimeout(t);
	}
	
	$("#start").click(function(){
		init();
    	loop();
    	
    	window.setTimeout(showGift, Math.floor((Math.random()*5)+1)*1000);

	});
});
</script>
<style>
body {
  margin: 0;
}
#gifts{
	position: absolute;
	word-wrap:break-word;
	width:400px;
	overflow:auto;
	margin:0px;
}
</style>
    </head>
    <body>
        <canvas id="myCanvas" width="450" height="455" style="position: absolute;z-index:10"></canvas>
        <div id="gifts" style="position: relative">        	
        </div>        
        <button id="start" style="z-index:10">Start</button>
        <div id="log" style="position: relative"></div>
        <div id="gift" style="position: relative"></div>
    </body>
</html>

<script>
var t;
window.requestAnimFrame = (function(callback) {		
    return function(callback) {    	
               t = window.setTimeout(callback, 1000/6);        		
           };
})();

window.onload = function() {
    //init();
    //loop();
};

var canvas, context;
var lastTime;
var x, y;
var rW, rH;
var speed;
var flag = 0;
//初始化
function init() {
   canvas = document.getElementById("myCanvas");
   context = canvas.getContext("2d");

   x = 0;
   y = 0;
   rW = 75;
   rH = 75;
   speed = 75;
   lastTime = new Date().getTime();
}

//時間迴圈
function loop() {
    requestAnimFrame(loop);
    update();
    draw();
}

//執行繪圖
function draw() {
    //清除整個畫布
    context.clearRect(0, 0, canvas.width, canvas.height);

    context.fillStyle = "rgba(255, 0, 0, 0.5)";
    context.beginPath();
    context.fillRect(x, y, rW, rH);
    context.closePath();
    context.fill();
}

//計算
var type = 1;
function update(){
    var time = new Date().getTime();
    var diff = time - lastTime;
        
    //var distFrame = speed * diff / 1000;
    
    switch(type){
    	case 1:
    		x+=speed;
    		if(x>=375) type++;    		
    		break;
    		
    	case 2:
    		y=y+speed+1.2;
    		if(y>=canvas.height-rH-rH) type++;
    		break;
    	case 3:
    		x-=speed;
    		if(x<=0) type++;
    		break;
    	case 4:
    		y=y-speed-1.2;
    		if(y<=0) type=1;
    		break;
    }
    
    lastTime = time;
    
    $("#log").html("x:"+Math.ceil(x/75)+"y:"+Math.ceil(y/75));
    if(y!=0) 
    	giftid = Math.ceil(x/75) + 6*(Math.ceil(y/75)-1);
    else
    	giftid = Math.ceil(x/75) + 6*(Math.ceil(y/75)+1)+1;

	$("#gift").text(giftid);    
}
</script>

