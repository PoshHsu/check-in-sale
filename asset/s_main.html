<!DOCTYPE html>
<html lang="en">
<head>
<meta charset='utf-8'> 
<script src="js/jquery-v1.7.2.js"></script>

<!-- include bootstrap library -->
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-datepicker.js"></script>
<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="css/datepicker.css" rel="stylesheet">
<script src="js/FBplus.js"></script>
    
<style type="text/css">
body {
    padding-top: 60px;
    padding-bottom: 40px;
}


</style>

<script>

var tmp,
	myFBID;

$(document).ready(function(){
	//show all tooltip by bootstrap
	$("[rel=tooltip]").tooltip();
	
	//$('#mymenu a:last').tab('show');
	$('#mymenu a').click(function (e) {
  		//console.log($(this).tab('show'));
  		$(this).tab('show');
	});
	
	$('.datepicker').datepicker({
		formar:'mm/dd/yyyy'	
	});


	//FBplus
	var PLUS_CONFIG = {
		CLIENT_ID:"445111025530197",
		SECRET_ID:"d530cadfb49b87c1aae50e1f3c7db506",
		REDIRECT_URI:"http://checkinsale.com/s_main.html",
		TOKEN:"AAAGU03yP9VUBAOv0R4As17hsQyISvTQ3MyowAiUZCXHILPv92xHpMMuOJi6Lry2xkHFv32KZCh7qu174AqSOTl4bswa0TbmhQhYBhFZCgZDZD"		
	};
	
	FBplus.prototype.config = PLUS_CONFIG;

	var scope = "read_stream,publish_checkins,publish_stream,user_status,user_checkins,read_stream,user_birthday,friends_status";
	
	FBplus(["auth"], function(plus){
    	var link = "<a href='" + plus.auth.getLoginUrl(scope) + "'><img src='http://checkinsale.com/image/FBlogin.png'></img></a>";
    	$("#login").append(link);
    });
	
	$("#login").append;
	console.log("ready");

	
	//get checkin list
	FBplus(["checkin","friends"], function(plus){
		
		plus.friends.getFriendInfo(function(data,e){
			myFBID = data.id;
			
			//query checkin list
			$.ajax({
				url: "users/"+myFBID,
				type: "GET",	
				dataType: "json",
			        success:function(data){
			        	//console.dir(data);
			        	//data.rows[0].value['check-in-points'][0]
			        	$("#place").html("<p>近期的打卡點,請勾選屬於您的打卡點</p>");
			        	for(var i=0,len=data.rows[0].value.checkInPoints.length;i<len;i++){				
							var cb = '<label class="checkbox"><input type="checkbox" checked value="'+data.rows[0].value.checkInPoints[i].fbPlaceId+'">'+data.rows[0].value.checkInPoints[i].name+'</label>';
							$("#place").append(cb);				
						}                     
			        }
			});	
		});
		
		plus.checkin.getMeCheckin(function(data){
			
			//$("#place").append("<p>近期的打卡點,請勾選屬於您的打卡點</p>");
			for(var i=0,len=data.data.length;i<len;i++){				
				var cb = '<label class="checkbox"><input type="checkbox" value="'+data.data[i].place.id+'">'+data.data[i].place.name+'</label>';
				$("#place").append(cb);				
			}					
  		});
	});


		var checkinpoints = [];
	
		//add checkin list data	
		$("#addCheckinList").click(function() {
			
		$('.checkbox :checked').each(function() {		   	
			checkinpoints.push({ "name": $(this).parent().text(), "fbPlaceId": $(this).val() });
		});
	 	
		checkinlist = {
                  "fbUserId": myFBID,
                  "fbPlaceId": checkinpoints,
                  "joined": [2012, 10, 20]
                };
		
		  $.ajax({
                url: "users/add",
                type: "POST",
                data: checkinlist,
                dataType: "json",
                success:function(data){
                	console.log(data);                     
                }
        });
		
	});

	
		
	

});
</script>
</head>

<body>

<!-- fb login start-->
<div id="fb-root"></div>
   
        <!-- Login -->

 <div class="navbar navbar-inverse navbar-fixed-top" id="mymenu">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#home">輕鬆打 Check-in Sale</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
				<li><a href="#chart" class="dropdown-toggle" title="檢視報表資訊" rel="tooltip">報表</a></li>				 
				<li><a href="#description" rel="tooltip" title="瀏覽既有的活動及報表" data-placement="bottom">活動管理</a></li>              
				<li><a href="#newactions" rel="tooltip" title="建立新的促銷活動" data-placement="bottom">建立新活動</a></li>
				<li><a href="#profile" class="dropdown-toggle" title="設定基本資訊" rel="tooltip">基本資料</a></li>                                          
			</ul>
            
            
            
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

	
    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
    	<div class="tab-content">
			  
			<div class="tab-pane fade" id="home">
				首頁不知道要擺啥
			</div>
			
			<div class="tab-pane fade" id="profile">
				<h2>Profile</h2>
				<div class="form-actions">
					<div id="place">
						<label class="checkbox">
  							Loading...
						</label>
					</div>					
					<button type="submit" id="addCheckinList" class="btn btn-primary">Save changes</button>
				  	<button type="button" class="btn">Cancel</button>
				</div>
				
			</div>
			
			<div class="tab-pane fade in active" id="description">
				<div><select class="span2">
					<option>全部</option>
  					<option>活動一</option>
  					<option>活動二</option>
				</select>
				</div>
				
				<ul class="breadcrumb">					
  					<li class="active"><a href="#today">今日</a> <span class="divider">/</span></li>
  					<li><a href="#lastday">昨日</a> <span class="divider">/</span></li>
  					<li><a href="#lastweek">上週</a> <span class="divider">/</span></li>
				</ul>
				
				<div id="metadata">
					<div class="row-fluid show-grid">
						<div class="span4">
							<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      // Load the Visualization API and the piechart package.
      google.load('visualization', '1.0', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(drawChart);
google.setOnLoadCallback(drawChart2);
      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['Mushrooms', 3],
          ['Onions', 1],
          ['Olives', 1],
          ['Zucchini', 1],
          ['Pepperoni', 2]
        ]);

        // Set chart options
        var options = {'title':'How Much Pizza I Ate Last Night',
                       'width':400,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }
      
      function drawChart2() {
        var data = google.visualization.arrayToDataTable([
          ['Day', 'Count'],
          ['10/17',  2],
          ['10/18',  3],
          ['10/19',  1],
          ['10/20',  10]
        ]);

        var options = {
          title: '每日打卡數',
          vAxis: {title: 'Count',  titleTextStyle: {color: 'red'}},
          seriesType: "bars",
          
        };

        var chart = new google.visualization.ComboChart(document.getElementById('chart2_div'));
        chart.draw(data, options);
      }
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
    <div id="chart2_div"></div>
  </body>
</html>	

						</div>
						<div class="span8">每日打卡人數</div>
					</div>
					<hr>
					<div class="row-fluid show-grid">
						<div class="span6">平均累積按讚的次數</div>
						<div class="span6">各時間點的平均打卡數</div>
					</div>
					
				</div>
			</div>
			
			
			
			<div class="tab-pane fade" id="newactions">
				<form class="form-horizontal" action="">
					<legend>建立新的促銷活動</legend>

					<div class="control-group">
				    	<label class="control-label" for="contents">促銷內容</label>
						<div class="controls">
				      		<textarea rows="4" placeholder="請輸入促銷內容，例：現在打卡即享有9.5折優惠"></textarea>
				    	</div>
				  	</div>
				
					<div class="control-group">
				    	<label class="control-label" for="solgon">活動標語</label>
						<div class="controls">
				      		<input type="text" class="input-large" placeholder="請輸入活動標語，例：我愛薑母鴨">
				    	</div>
				  	</div>
				  	
				  	<div class="control-group">
				    	<label class="control-label" for="session">活動期間</label>
						<div class="controls">
				      		<input type="text" class="datepicker" id="start_date" placeholder="開始時間">~<input type="text" class="datepicker" id="end_date" placeholder="結束時間">
				    	</div>
				  	</div>
				
					<div class="control-group">
				    	<label class="control-label" for="session">活動照片</label>
						<div class="controls">
							<form method="post" enctype="multipart/form-data" action="/fileUpload">
         						<input type="file" name="uploadingFile">         						 
    						</form>				      		
				    	</div>
				  	</div>
				  	
					<div class="control-group">
						
						<div class="controls">
						<button type="submit" class="btn btn-primary">新增</button>  						
  						</div>
					</div>
				</form>
			</div>	
					
		</div>	
          
          
		

	<hr>    

	<div class="navbar navbar-fixed-bottom">
		<div class="navbar-inner">
			<div class="container">
				<p style="margin-top:10px">&copy; 2012 Taylor, Diman, Posheng and Squall All Rights Reserved. </p>
        	</div>
      	</div>
	</div>


</body>


</html>
